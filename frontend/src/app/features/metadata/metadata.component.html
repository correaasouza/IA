<div class="page">
  <header class="page-header">
    <div class="title-block">
      <h1>Metadados</h1>
      <p>Configuração de campos fixos por tipo de entidade</p>
    </div>
  </header>

  <section class="panel">
    <div class="panel-header">
      <div class="panel-title">Tipos de entidade</div>
      <div class="panel-meta">Cadastre e selecione um tipo para configurar campos</div>
    </div>

    <form [formGroup]="tipoForm" (ngSubmit)="createTipo()" class="form-inline">
      <mat-form-field appearance="outline">
        <mat-label>Código</mat-label>
        <input matInput formControlName="codigo" placeholder="CLIENTE" aria-label="Código do tipo" />
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Nome</mat-label>
        <input matInput formControlName="nome" placeholder="Cliente" aria-label="Nome do tipo" />
      </mat-form-field>
      <mat-slide-toggle formControlName="ativo">Ativo</mat-slide-toggle>
      <button mat-flat-button color="primary" type="submit">Adicionar</button>
    </form>

    <div class="table-wrap">
      <table mat-table [dataSource]="tipos" class="table-dense">
        <ng-container matColumnDef="codigo">
          <th mat-header-cell *matHeaderCellDef>Código</th>
          <td mat-cell *matCellDef="let row">{{ row.codigo }}</td>
        </ng-container>
        <ng-container matColumnDef="nome">
          <th mat-header-cell *matHeaderCellDef>Nome</th>
          <td mat-cell *matCellDef="let row">{{ row.nome }}</td>
        </ng-container>
        <ng-container matColumnDef="ativo">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let row">
            <span class="status" [class.off]="!row.ativo">{{ row.ativo ? 'Ativo' : 'Inativo' }}</span>
          </td>
        </ng-container>
        <ng-container matColumnDef="acoes">
          <th mat-header-cell *matHeaderCellDef>Ações</th>
          <td mat-cell *matCellDef="let row">
            <button mat-stroked-button type="button" (click)="selectTipo(row)">
              <mat-icon>tune</mat-icon>
              Configurar
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="tipoColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: tipoColumns;" class="data-row"></tr>
      </table>
    </div>
  </section>

  <section class="panel" *ngIf="tipoSelecionado">
    <div class="panel-header">
      <div class="panel-title">Campos do tipo {{ tipoSelecionado?.nome }}</div>
      <div class="panel-meta">Habilite, defina obrigatoriedade e label</div>
    </div>

    <div class="panel-content">
      <div class="inline-status" *ngIf="loadingCampos">
        <app-inline-loader label="Carregando campos"></app-inline-loader>
      </div>
    </div>

    <div class="table-wrap">
      <table mat-table [dataSource]="campos" class="table-dense">
        <ng-container matColumnDef="campo">
          <th mat-header-cell *matHeaderCellDef>Campo</th>
          <td mat-cell *matCellDef="let row">{{ row.campo }}</td>
        </ng-container>
        <ng-container matColumnDef="label">
          <th mat-header-cell *matHeaderCellDef>Label</th>
          <td mat-cell *matCellDef="let row">
            <input class="table-input" [(ngModel)]="row.label" [ngModelOptions]="{standalone: true}" />
          </td>
        </ng-container>
        <ng-container matColumnDef="habilitado">
          <th mat-header-cell *matHeaderCellDef>Habilitado</th>
          <td mat-cell *matCellDef="let row">
            <mat-slide-toggle [(ngModel)]="row.habilitado" [ngModelOptions]="{standalone: true}"></mat-slide-toggle>
          </td>
        </ng-container>
        <ng-container matColumnDef="requerido">
          <th mat-header-cell *matHeaderCellDef>Obrigatório</th>
          <td mat-cell *matCellDef="let row">
            <mat-slide-toggle [(ngModel)]="row.requerido" [ngModelOptions]="{standalone: true}"></mat-slide-toggle>
          </td>
        </ng-container>
        <ng-container matColumnDef="visivel">
          <th mat-header-cell *matHeaderCellDef>Visível</th>
          <td mat-cell *matCellDef="let row">
            <mat-slide-toggle [(ngModel)]="row.visivel" [ngModelOptions]="{standalone: true}"></mat-slide-toggle>
          </td>
        </ng-container>
        <ng-container matColumnDef="editavel">
          <th mat-header-cell *matHeaderCellDef>Editável</th>
          <td mat-cell *matCellDef="let row">
            <mat-slide-toggle [(ngModel)]="row.editavel" [ngModelOptions]="{standalone: true}"></mat-slide-toggle>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="campoColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: campoColumns;"></tr>
      </table>
    </div>

    <div class="panel-actions">
      <button mat-flat-button color="primary" type="button" (click)="saveCampos()" [disabled]="savingCampos">
        <mat-icon>save</mat-icon>
        Salvar configuração
      </button>
    </div>
  </section>
</div>
