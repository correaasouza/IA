<div class="grid gap-3">
  <header class="flex flex-col items-start justify-between gap-3 md:flex-row md:items-end">
    <div>
      <h1 class="m-0 text-lg font-bold">Configurações de entidades</h1>
      <p class="mt-1 text-xs text-[var(--muted)]">Controle status dos tipos e tipos de contato</p>
    </div>
  </header>

  <section class="rounded-xl border border-[var(--border)] bg-[var(--surface)] p-3 shadow-[var(--shadow-xs)]">
    <div class="mb-2.5 flex items-center justify-between gap-2">
      <div class="text-sm font-semibold">Tipos de entidade</div>
      <div class="text-xs text-[var(--muted)]">Atualize nome e status</div>
    </div>

    <div class="flex justify-end pb-2" *ngIf="loading">
      <app-inline-loader label="Carregando tipos"></app-inline-loader>
    </div>

    <div class="overflow-auto border-t border-[var(--border-light)]" *ngIf="tipos.length > 0">
      <table mat-table [dataSource]="tipos" class="w-full">
        <ng-container matColumnDef="codigo">
          <th mat-header-cell *matHeaderCellDef>Código</th>
          <td mat-cell *matCellDef="let row">{{ row.codigo }}</td>
        </ng-container>
        <ng-container matColumnDef="nome">
          <th mat-header-cell *matHeaderCellDef>Nome</th>
          <td mat-cell *matCellDef="let row">
            <input matInput [value]="row.nome" (input)="row.nome = $any($event.target).value" aria-label="Nome" />
          </td>
        </ng-container>
        <ng-container matColumnDef="ativo">
          <th mat-header-cell *matHeaderCellDef>Ativo</th>
          <td mat-cell *matCellDef="let row">
            <mat-slide-toggle [(ngModel)]="row.ativo" aria-label="Ativo"></mat-slide-toggle>
          </td>
        </ng-container>
        <ng-container matColumnDef="save">
          <th mat-header-cell *matHeaderCellDef>Ação</th>
          <td mat-cell *matCellDef="let row" class="flex flex-wrap items-center gap-1.5">
            <button mat-stroked-button (click)="saveDef(row)" [disabled]="savingIds.has(row.id)">
              <mat-icon>save</mat-icon>
              Salvar
            </button>
            <span class="inline-flex items-center gap-1.5 rounded-full border border-[var(--border-light)] bg-[var(--surface-muted)] px-2 py-0.5 text-xs text-[var(--success-ink)]" *ngIf="savedIds.has(row.id)">
              <mat-icon>check_circle</mat-icon>
              Salvo
            </span>
            <span class="inline-flex items-center gap-1.5 rounded-full border border-[var(--border-light)] bg-[var(--surface-muted)] px-2 py-0.5 text-xs text-[#b42318]" *ngIf="errorIds.has(row.id)">
              <mat-icon>error</mat-icon>
              Erro
            </span>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="defColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: defColumns;"></tr>
      </table>
    </div>

    <section class="flex items-center gap-3 pt-2 text-[var(--muted)]" *ngIf="tipos.length === 0">
      <mat-icon class="!h-7 !w-7 !text-[28px]">category</mat-icon>
      <div>
        <div class="font-semibold text-[var(--ink)]">Nenhum tipo encontrado</div>
        <div class="text-xs">Cadastre tipos de entidade para configurar permissões.</div>
      </div>
    </section>
  </section>

  <section class="rounded-xl border border-[var(--border)] bg-[var(--surface)] p-3 shadow-[var(--shadow-xs)]">
    <div class="mb-2.5 flex items-center justify-between gap-2">
      <div class="text-sm font-semibold">Configurar tipos de contato</div>
      <div class="text-xs text-[var(--muted)]">Gerencie opções e máscaras</div>
    </div>
    <app-contato-tipos></app-contato-tipos>
  </section>
</div>
